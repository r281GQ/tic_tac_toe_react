<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for services/minimax.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">All files</a> / <a href="index.html">services</a> minimax.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>43/43</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>21/21</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>17/17</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>40/40</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130</td><td class="line-coverage quiet"><span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">2534x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20272x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18252x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">13352x</span>
<span class="cline-any cline-yes">13352x</span>
<span class="cline-any cline-yes">13352x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">5533x</span>
<span class="cline-any cline-yes">5533x</span>
<span class="cline-any cline-yes">5533x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">1669x</span>
<span class="cline-any cline-yes">1669x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15021x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1669x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15021x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">27x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1390x</span>
<span class="cline-any cline-yes">258x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1132x</span>
<span class="cline-any cline-yes">221x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">911x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">737x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">712x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">712x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">651x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">651x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">27x</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">27x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">const PLAYER = 'PLAYER';
const COMPUTER = 'COMPUTER';
&nbsp;
//checks if the game has been won already
const isGameWon = (player, state) =&gt;
  [[1, 1], [4, 1], [7, 1], [1, 3], [2, 3], [3, 3], [1, 4], [3, 2]]
    .map(
      value =&gt;
        state[value[0]] === player &amp;&amp;
        state[value[0] + value[1]] === player &amp;&amp;
        state[value[0] + value[1] + value[1]] === player
    )
    .find(value =&gt; value === true)
    ? true
    : false;
&nbsp;
const converToAscending = (sum, item) =&gt; {
  if (sum.length === 0) sum.push(item);
  sum.push(item + sum[sum.length - 1]);
  return sum;
};
&nbsp;
//takes the current state and creates a new one with the players new move in it
//first the movesLeft is invoked, therefore the move will allways be valid
const makeMove = (state, move, player) =&gt; {
  let newState = Object.assign({}, state);
  newState[move] = player;
  return newState;
};
&nbsp;
/**
 * Calculates the remaining moves.
 * Example: only the upper left and upper right corner is free then returns [1,3].
 * @param  {[key: number]: string} state [description]
 * @return {Array}       Returns an array of numbers representing the available moves as numbers from 1-9.
 */
const movesLeft = state =&gt; {
  const movesLeftContainer = [];
  Object.keys(state).forEach(
    key =&gt;
      state[key] !== '' ? movesLeftContainer.push(Number.parseInt(key)) : null
  );
  return Array(8)
    .fill(1)
    .reduce(converToAscending, [])
    .filter(value =&gt; !movesLeftContainer.includes(value));
};
&nbsp;
/**
 * Seperated method for logging porpuses.
 * @param  {[key: number]: string} state The acutal game state represented with a js 'map' where the keys are number from 1-9 and the value is the player.
 * @return {[value: number, move: number]}       Array of key value pairs, where key is the potential move with the calculated value.
 */
const miniMax = state =&gt;
  movesLeft(state).map(value =&gt; ({
    value: miniMaxHelper(state, COMPUTER, value, 0),
    move: value
  }));
&nbsp;
/**
 * Recursively explores all the available possible game moves.
 * @param  {[key: number]: string} state          The acutal game state represented with a js 'map' where the keys are number from 1-9 and the value is the player.
 * @param  {string} player         The player who will take the next move. Can either be const PLAYER or COMPUTER.
 * @param  {number} move           The next move from 1-9.
 * @param  {number} differentiator This variable makes sure the computer goes with the solution that can be achieved with the least amount of steps. Increments with every depth.
 * @return {number}                Number representing how good or bad a move is for the given player.
 */
const miniMaxHelper = (state, player, move, differentiator) =&gt; {
  //basecase: player won
  if (isGameWon(PLAYER, makeMove(state, move, player)))
    return -100 + differentiator;
&nbsp;
  //basecase: computer won
  if (isGameWon(COMPUTER, makeMove(state, move, player)))
    return 100 - differentiator;
&nbsp;
  //basecase: no more steps left
  if (movesLeft(makeMove(state, move, player)).length === 0) return 0;
&nbsp;
  //recursively explores all possible moves and minimizes for the computer or maximizes for player
  return player === COMPUTER
    ? movesLeft(makeMove(state, move, player))
        .map(value =&gt;
          miniMaxHelper(
            makeMove(state, move, player),
            PLAYER,
            value,
            ++differentiator
          )
        )
        .reduce(
          (currentMinimum, value) =&gt; Math.min(currentMinimum, value),
          100000
        )
    : movesLeft(makeMove(state, move, player))
        .map(value =&gt;
          miniMaxHelper(
            makeMove(state, move, player),
            COMPUTER,
            value,
            ++differentiator
          )
        )
        .reduce(
          (currentMaximum, value) =&gt; Math.max(currentMaximum, value),
          -100000
        );
};
&nbsp;
const reduceToNextMove = (sum, item) =&gt; {
  if (item.value &gt; sum.currentVaule) {
    sum.currentVaule = item.value;
    sum.move = item.move;
  }
  return sum;
};
&nbsp;
/**
 * Calculates the next best move for the computer based on the current game state.
 * @param  {[key: number]: string} state          The acutal game state represented with a js 'map' where the keys are number from 1-9 and the value is the player.
 * @return {number}       The field number of the board.
 */
const getComputerMove = state =&gt;
  movesLeft(state).length !== 0
    ? miniMax(state).reduce(reduceToNextMove, { currentVaule: -1, move: 0 })
        .move
    : -1;
&nbsp;
export { getComputerMove, isGameWon, movesLeft, PLAYER, COMPUTER };
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Sun Aug 20 2017 12:24:54 GMT+0100 (BST)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
